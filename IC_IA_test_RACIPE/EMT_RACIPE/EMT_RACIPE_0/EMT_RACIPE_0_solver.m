params = {'Act_of_FOXC2ToZEB1', 'Num_of_FOXC2ToZEB1', 'Trd_of_FOXC2ToZEB1', 'Inh_of_KLF8ToCDH1', 'Num_of_KLF8ToCDH1', 'Trd_of_KLF8ToCDH1', 'Inh_of_miR101ToKLF8', 'Num_of_miR101ToKLF8', 'Trd_of_miR101ToKLF8', 'Inh_of_miR101ToZEB1', 'Num_of_miR101ToZEB1', 'Trd_of_miR101ToZEB1', 'Inh_of_miR101ToZEB2', 'Num_of_miR101ToZEB2', 'Trd_of_miR101ToZEB2', 'Inh_of_miR101ToSNAI1', 'Num_of_miR101ToSNAI1', 'Trd_of_miR101ToSNAI1', 'Inh_of_miR141ToZEB1', 'Num_of_miR141ToZEB1', 'Trd_of_miR141ToZEB1', 'Inh_of_miR141ToZEB2', 'Num_of_miR141ToZEB2', 'Trd_of_miR141ToZEB2', 'Inh_of_miR141ToTGFbeta', 'Num_of_miR141ToTGFbeta', 'Trd_of_miR141ToTGFbeta', 'Inh_of_miR200aToZEB1', 'Num_of_miR200aToZEB1', 'Trd_of_miR200aToZEB1', 'Inh_of_miR200aToZEB2', 'Num_of_miR200aToZEB2', 'Trd_of_miR200aToZEB2', 'Inh_of_miR200aToTGFbeta', 'Num_of_miR200aToTGFbeta', 'Trd_of_miR200aToTGFbeta', 'Inh_of_miR200bToZEB1', 'Num_of_miR200bToZEB1', 'Trd_of_miR200bToZEB1', 'Inh_of_miR200bToZEB2', 'Num_of_miR200bToZEB2', 'Trd_of_miR200bToZEB2', 'Inh_of_miR200bToTGFbeta', 'Num_of_miR200bToTGFbeta', 'Trd_of_miR200bToTGFbeta', 'Inh_of_miR200cToZEB1', 'Num_of_miR200cToZEB1', 'Trd_of_miR200cToZEB1', 'Inh_of_miR200cToZEB2', 'Num_of_miR200cToZEB2', 'Trd_of_miR200cToZEB2', 'Inh_of_miR200cToTGFbeta', 'Num_of_miR200cToTGFbeta', 'Trd_of_miR200cToTGFbeta', 'Inh_of_miR205ToZEB1', 'Num_of_miR205ToZEB1', 'Trd_of_miR205ToZEB1', 'Inh_of_miR205ToZEB2', 'Num_of_miR205ToZEB2', 'Trd_of_miR205ToZEB2', 'Inh_of_miR30cToSNAI1', 'Num_of_miR30cToSNAI1', 'Trd_of_miR30cToSNAI1', 'Inh_of_miR30cToSNAI2', 'Num_of_miR30cToSNAI2', 'Trd_of_miR30cToSNAI2', 'Inh_of_miR30cToZEB2', 'Num_of_miR30cToZEB2', 'Trd_of_miR30cToZEB2', 'Inh_of_miR34aToSNAI1', 'Num_of_miR34aToSNAI1', 'Trd_of_miR34aToSNAI1', 'Inh_of_miR34aToSNAI2', 'Num_of_miR34aToSNAI2', 'Trd_of_miR34aToSNAI2', 'Inh_of_miR34aToTWIST2', 'Num_of_miR34aToTWIST2', 'Trd_of_miR34aToTWIST2', 'Inh_of_miR34aToZEB1', 'Num_of_miR34aToZEB1', 'Trd_of_miR34aToZEB1', 'Inh_of_miR9ToCDH1', 'Num_of_miR9ToCDH1', 'Trd_of_miR9ToCDH1', 'Inh_of_miR9ToZEB2', 'Num_of_miR9ToZEB2', 'Trd_of_miR9ToZEB2', 'Inh_of_SNAI1ToCDH1', 'Num_of_SNAI1ToCDH1', 'Trd_of_SNAI1ToCDH1', 'Act_of_SNAI1ToVIM', 'Num_of_SNAI1ToVIM', 'Trd_of_SNAI1ToVIM', 'Act_of_SNAI1ToFOXC2', 'Num_of_SNAI1ToFOXC2', 'Trd_of_SNAI1ToFOXC2', 'Inh_of_SNAI1ToSNAI1', 'Num_of_SNAI1ToSNAI1', 'Trd_of_SNAI1ToSNAI1', 'Act_of_SNAI1ToSNAI2', 'Num_of_SNAI1ToSNAI2', 'Trd_of_SNAI1ToSNAI2', 'Act_of_SNAI1ToTWIST1', 'Num_of_SNAI1ToTWIST1', 'Trd_of_SNAI1ToTWIST1', 'Act_of_SNAI1ToZEB1', 'Num_of_SNAI1ToZEB1', 'Trd_of_SNAI1ToZEB1', 'Act_of_SNAI1ToZEB2', 'Num_of_SNAI1ToZEB2', 'Trd_of_SNAI1ToZEB2', 'Inh_of_SNAI1TomiR34a', 'Num_of_SNAI1TomiR34a', 'Trd_of_SNAI1TomiR34a', 'Inh_of_SNAI1TomiR101', 'Num_of_SNAI1TomiR101', 'Trd_of_SNAI1TomiR101', 'Inh_of_SNAI2ToCDH1', 'Num_of_SNAI2ToCDH1', 'Trd_of_SNAI2ToCDH1', 'Act_of_SNAI2ToVIM', 'Num_of_SNAI2ToVIM', 'Trd_of_SNAI2ToVIM', 'Act_of_SNAI2ToSNAI2', 'Num_of_SNAI2ToSNAI2', 'Trd_of_SNAI2ToSNAI2', 'Act_of_SNAI2ToTWIST2', 'Num_of_SNAI2ToTWIST2', 'Trd_of_SNAI2ToTWIST2', 'Inh_of_SNAI2TomiR101', 'Num_of_SNAI2TomiR101', 'Trd_of_SNAI2TomiR101', 'Inh_of_SNAI2TomiR200b', 'Num_of_SNAI2TomiR200b', 'Trd_of_SNAI2TomiR200b', 'Inh_of_TCF3ToCDH1', 'Num_of_TCF3ToCDH1', 'Trd_of_TCF3ToCDH1', 'Inh_of_TWIST1ToCDH1', 'Num_of_TWIST1ToCDH1', 'Trd_of_TWIST1ToCDH1', 'Act_of_TWIST1ToVIM', 'Num_of_TWIST1ToVIM', 'Trd_of_TWIST1ToVIM', 'Act_of_TWIST1ToFOXC2', 'Num_of_TWIST1ToFOXC2', 'Trd_of_TWIST1ToFOXC2', 'Act_of_TWIST1ToSNAI1', 'Num_of_TWIST1ToSNAI1', 'Trd_of_TWIST1ToSNAI1', 'Act_of_TWIST1ToSNAI2', 'Num_of_TWIST1ToSNAI2', 'Trd_of_TWIST1ToSNAI2', 'Act_of_TWIST1ToTCF3', 'Num_of_TWIST1ToTCF3', 'Trd_of_TWIST1ToTCF3', 'Act_of_TWIST1ToZEB1', 'Num_of_TWIST1ToZEB1', 'Trd_of_TWIST1ToZEB1', 'Act_of_TWIST1ToZEB2', 'Num_of_TWIST1ToZEB2', 'Trd_of_TWIST1ToZEB2', 'Inh_of_TWIST2ToCDH1', 'Num_of_TWIST2ToCDH1', 'Trd_of_TWIST2ToCDH1', 'Act_of_TWIST2ToSNAI1', 'Num_of_TWIST2ToSNAI1', 'Trd_of_TWIST2ToSNAI1', 'Act_of_TWIST2ToSNAI2', 'Num_of_TWIST2ToSNAI2', 'Trd_of_TWIST2ToSNAI2', 'Act_of_TWIST2ToTWIST1', 'Num_of_TWIST2ToTWIST1', 'Trd_of_TWIST2ToTWIST1', 'Act_of_TWIST2ToZEB1', 'Num_of_TWIST2ToZEB1', 'Trd_of_TWIST2ToZEB1', 'Act_of_TWIST2ToZEB2', 'Num_of_TWIST2ToZEB2', 'Trd_of_TWIST2ToZEB2', 'Inh_of_ZEB1ToCDH1', 'Num_of_ZEB1ToCDH1', 'Trd_of_ZEB1ToCDH1', 'Act_of_ZEB1ToVIM', 'Num_of_ZEB1ToVIM', 'Trd_of_ZEB1ToVIM', 'Inh_of_ZEB1TomiR141', 'Num_of_ZEB1TomiR141', 'Trd_of_ZEB1TomiR141', 'Inh_of_ZEB1TomiR200b', 'Num_of_ZEB1TomiR200b', 'Trd_of_ZEB1TomiR200b', 'Inh_of_ZEB1TomiR200c', 'Num_of_ZEB1TomiR200c', 'Trd_of_ZEB1TomiR200c', 'Inh_of_ZEB1TomiR200a', 'Num_of_ZEB1TomiR200a', 'Trd_of_ZEB1TomiR200a', 'Inh_of_ZEB1TomiR34a', 'Num_of_ZEB1TomiR34a', 'Trd_of_ZEB1TomiR34a', 'Act_of_ZEB1ToZEB1', 'Num_of_ZEB1ToZEB1', 'Trd_of_ZEB1ToZEB1', 'Inh_of_ZEB2ToCDH1', 'Num_of_ZEB2ToCDH1', 'Trd_of_ZEB2ToCDH1', 'Act_of_ZEB2ToVIM', 'Num_of_ZEB2ToVIM', 'Trd_of_ZEB2ToVIM', 'Inh_of_ZEB2TomiR200b', 'Num_of_ZEB2TomiR200b', 'Trd_of_ZEB2TomiR200b', 'Inh_of_ZEB2TomiR200c', 'Num_of_ZEB2TomiR200c', 'Trd_of_ZEB2TomiR200c', 'Inh_of_ZEB2TomiR200a', 'Num_of_ZEB2TomiR200a', 'Trd_of_ZEB2TomiR200a', 'Act_of_ZEB2ToZEB2', 'Num_of_ZEB2ToZEB2', 'Trd_of_ZEB2ToZEB2', 'Act_of_GSCToSNAI1', 'Num_of_GSCToSNAI1', 'Trd_of_GSCToSNAI1', 'Act_of_GSCToTWIST1', 'Num_of_GSCToTWIST1', 'Trd_of_GSCToTWIST1', 'Act_of_GSCToFOXC2', 'Num_of_GSCToFOXC2', 'Trd_of_GSCToFOXC2', 'Act_of_GSCToZEB1', 'Num_of_GSCToZEB1', 'Trd_of_GSCToZEB1', 'Act_of_GSCToZEB2', 'Num_of_GSCToZEB2', 'Trd_of_GSCToZEB2', 'Act_of_TGFbetaToGSC', 'Num_of_TGFbetaToGSC', 'Trd_of_TGFbetaToGSC', 'Act_of_TGFbetaToSNAI1', 'Num_of_TGFbetaToSNAI1', 'Trd_of_TGFbetaToSNAI1', 'Act_of_TGFbetaToSNAI2', 'Num_of_TGFbetaToSNAI2', 'Trd_of_TGFbetaToSNAI2', 'Prod_of_FOXC2', 'Deg_of_FOXC2', 'Prod_of_KLF8', 'Deg_of_KLF8', 'Prod_of_miR101', 'Deg_of_miR101', 'Prod_of_miR141', 'Deg_of_miR141', 'Prod_of_miR200a', 'Deg_of_miR200a', 'Prod_of_miR200b', 'Deg_of_miR200b', 'Prod_of_miR200c', 'Deg_of_miR200c', 'Prod_of_miR205', 'Deg_of_miR205', 'Prod_of_miR30c', 'Deg_of_miR30c', 'Prod_of_miR34a', 'Deg_of_miR34a', 'Prod_of_miR9', 'Deg_of_miR9', 'Prod_of_SNAI1', 'Deg_of_SNAI1', 'Prod_of_SNAI2', 'Deg_of_SNAI2', 'Prod_of_TCF3', 'Deg_of_TCF3', 'Prod_of_TWIST1', 'Deg_of_TWIST1', 'Prod_of_TWIST2', 'Deg_of_TWIST2', 'Prod_of_ZEB1', 'Deg_of_ZEB1', 'Prod_of_ZEB2', 'Deg_of_ZEB2', 'Prod_of_GSC', 'Deg_of_GSC', 'Prod_of_TGFbeta', 'Deg_of_TGFbeta', 'Prod_of_CDH1', 'Deg_of_CDH1', 'Prod_of_VIM', 'Deg_of_VIM'};
prs_file = 'EMT_RACIPE_0.prs';
prs_new = 'EMT_RACIPE_0.dat';
copyfile(prs_file, prs_new);
par_list = readtable(prs_new);
par_list = string(par_list.Parameter);
par_list = arrayfun(@(x) replace(x, '-', ''),par_list);
par_order = zeros(length(par_list),1);
for i = 1:length(params)
    par_order(i) = find(par_list == params(i));
end
n_nodes = sum(contains(par_list, 'Prod'));
par_file = 'EMT_RACIPE_0_parameters.dat';
parameters = table2array(readtable(par_file));
parameters =  parameters(:, 3:end);
tspan = 1:1000;
ss_tot = zeros(1, n_nodes+1);
noConvergence = zeros(1, n_nodes+1);
dlmwrite('noConv.csv', noConvergence, 'delimiter', ',');
parfor i = 1:size(parameters,1)
    p = parameters(i,par_order);
    p1 = parameters(i,:);
    ss=zeros(1,n_nodes);
    lims = p1(1:n_nodes)./p1((1:n_nodes) + n_nodes);
    for j = 1:100
        IC = lims.*rand(1,n_nodes);
        y0 = IC;
        [t y] = ode23s(@(t,y)EMT_RACIPE_0(t,y,p), tspan, y0);
        for k = 1:50
        if sum(round((y(end, :) - y((end-1), :)), 3)) ~= 0
            y0 = y(end,:);
            [t y] = ode23s(@(t,y)EMT_RACIPE_0(t,y,p), tspan, y0);
        else
            break;
        end
        if k == 50
            noConvergence = [i IC]
            dlmwrite('noConv.csv', noConvergence, 'delimiter', ',', '-append');
        end
        end
        if all(abs(sum(ss - y(end, :),2)) > 0.01)
            ss = [ss;y(end, :)];
        end
    end
    ss = [repelem(i, size(ss(2:end,:),1))' ss(2:end, :)];
    ss_tot = [ss_tot; ss];
end
ss_tot = unique(ss_tot, 'rows');
ss_tot = array2table(ss_tot(2:end,:));
writetable(ss_tot, 'EMT_RACIPE_0_ss_1000.csv');
